## Download and install the Raspberry Pi Imager
https://www.raspberrypi.com/software/ 

Ubuntu: https://downloads.raspberrypi.org/imager/imager_latest_amd64.deb 

Windows: https://downloads.raspberrypi.org/imager/imager_latest.exe 

### Run the Raspberry Pi Imager
Then click "CHOOSE OS" under Operating System then "use custom" then select the `ubuntu-20.04.4-preinstalled-server-arm64+raspi.img.xz`
Then click "CHOOSE STORAGE" under Storage and then "Internal SD card reader"
Click "WRITE" enter your password if it promts you. 

Profit

After writing is compleate, boot the pi up and change the password(will prompt you to do it on login),

Once the system is back up verify it has network connectivity 
`ping 8.8.8.8`

### @NOTE where it is `#` please put the appropriate number
## Edit `/etc/hostname`
edit to just
`dragonfly#`

## Edit `/etc/hosts`
just below localhost paste
`127.0.1.1 dragonfly#`


if you miss the cloud init printout with the ip address you can install ifconfig
`sudo apt install net-tools`
Then run `ifconfig` and look at the inet under eth0, wlan0 and/or wlan1
@note you can also logout and back-in and it is part of the banner

# On the laptop/desktop

## Install ansible

## edit the  `/etc/ansible/hosts` file at the bottom add
```
[dragonflys]
ip_of_dragonfly1
ip_of_dragonfly2
ip_of_dragonfly3
ip_of_dragonfly4
ect
```

## Copy over your public ssh key
from the laptops `.ssh/id_rsa.pub`
insert into `.ssh/authorized_keys`
or just run `ssh-copy-id ubuntu@dragonfly's_ip`

@Note `dragonfly#.local` might resolve

## Run the playbook from the dragonfly-controller/scripts directory
`ansible-playbook playbook.yaml -u ubuntu`

@Note if you are getting this error below it is probably because unattended upgrades are in progress, so just wait a few minutes and run it again.
```
fatal: [64.106.39.115]: FAILED! => {"changed": false, "msg": "'/usr/bin/apt-get upgrade --with-new-pkgs ' failed: E: Could not get lock /var/lib/dpkg/lock-frontend. It is held by process 2551 (unattended-upgr)\nE: Unable to acquire the dpkg frontend lock (/var/lib/dpkg/lock-frontend), is another process using it?\n", "rc": 100, "stdout": "", "stdout_lines": []}

```


## Edit `/etc/netplan/20-adhoc.yaml` 
on the addresses line change the 1 to match the Dragonfly's number
```yaml
addresses: [10.42.0.1/24]
```
Then apply it and reboot
```bash
sudo netplan apply 
sudo reboot
```


# Install Mission Planner on Windows
https://ardupilot.org/planner/docs/mission-planner-installation.html

Connect Pixhawk to computer via USB cable

Flash Arducopter firmware and restart

Copy initial parameters from another Dragonfly and restart


Verify battery voltage.  If the battery voltage is too low (11V?) then you may need to recopy in the initial parameters.

Without propellers installed, perform a motor test.  Verify correct motor orientation and spin (reference above figure)


# Transmitters
## Download the companion applicaiton
https://www.open-tx.org/downloads click the most recent at the top then scroll to the bottom and under `Download links:` click the appropriate installer for your system. 

## Download the SD card image
https://downloads.open-tx.org/2.3/release/sdcard/opentx-t16/

## Verify a usb connection with the transmitter
Plug in the transmitter's micro usb if you are running linux run `lsusb | grep "DFU Mode"` to verify it has come up properly if not disassemble and inspect/reseat the ribbon cable
If all is good you should see this `Bus 001 Device 036: ID 0483:df11 STMicroelectronics STM Device in DFU Mode`

## Install the downloaded opentx companion applicaiton 
add the radio profile 
Radio type: Jumper T16
We have a mixure of radios so if the antenna is on the upper front then select `internalmulti` if there is the module installed below don't have it selected.
You can select `noheli` as we are running quads nto helicopters.

On the leftside make sure to download a copy of the original firmware and save it.
Make sure to click `show details` and read as you will get a `Flashing done` message even when it fails

Then `Write Firmware to radio` again make sure that the `show details` checkbox is checked and read the output to make sure the flashing compleated

Unplug the trasmiter and remove the sd card, make a copy of its contents, wipe it clean and then write to it the extracted files from what you downloaded in part `Download the SD card image`

Reinstall the SD card and power up the transmitter and calibrate the anologs 

## Rebind the trasmitter to the dragonflys
